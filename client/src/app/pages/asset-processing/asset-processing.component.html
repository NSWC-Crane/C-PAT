<!--
!#######################################################################
! C-PATTM SOFTWARE
! CRANE C-PATTM plan of action and milestones software. Use is governed by the Open Source Academic Research License Agreement contained in the file
! crane_C_PAT.1_license.txt, which is part of this software package. BY
! USING OR MODIFYING THIS SOFTWARE, YOU ARE AGREEING TO THE TERMS AND
! CONDITIONS OF THE LICENSE.
!########################################################################
-->

<div class="col-12 row">
  <div class="col">
    <p-card>
      <p-tabView>
        <p-tabPanel header="Asset Management">
          <div class="p-fluid">
            <div class="toolbar" style="display: flex; align-items: center;">
              <span class="p-input-icon-left">
                <i class="pi pi-search"></i>
                <input pInputText id="search" [(ngModel)]="filterValue" (input)="applyFilter($event)" placeholder="Search Assets" style="width: 300px;">
              </span>
              <p-button label="Clear" [outlined]="true" severity="info" class="ml-auto" icon="pi pi-filter-slash" (click)="clear()" (onKeyUp)="clear()"></p-button>
            </div>
            <div class="scrollable-assets">
              <p-table #assetTable
                       [value]="data"
                       selectionMode="multiple"
                       [(selection)]="selectedAssets"
                       [metaKeySelection]="true"
                       dataKey="assetId"
                       [globalFilterFields]="['assetId', 'assetName', 'description', 'ipAddress', 'macAddress']">
                <ng-template pTemplate="header">
                  <tr>
                    <th scope="col" style="min-width:5rem">
                      <div class="flex align-items-center">
                        Asset ID
                        <p-columnFilter type="text" field="assetId" display="menu" />
                      </div>
                    </th>
                    <th scope="col" style="min-width:15rem">
                      <div class="flex align-items-center">
                        Asset Name
                        <p-columnFilter type="text" field="assetName" display="menu" />
                      </div>
                    </th>
                    <th scope="col" style="min-width:15rem">
                      <div class="flex align-items-center">
                        Description
                        <p-columnFilter type="text" field="description" display="menu" />
                      </div>
                    </th>
                    <th scope="col" style="min-width:15rem">
                      <div class="flex align-items-center">
                        IP Address
                        <p-columnFilter type="text" field="ipAddress" display="menu" />
                      </div>
                    </th>
                    <th scope="col" style="min-width:15rem">
                      <div class="flex align-items-center">
                        MAC Address
                        <p-columnFilter type="text" field="macAddress" display="menu" />
                      </div>
                    </th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-asset let-rowIndex="rowIndex">
                  <tr [pSelectableRow]="asset" [pSelectableRowIndex]="rowIndex" (click)="setAsset(asset.assetId)" (onKeyUp)="setAsset(asset.assetId)">
                    <td>{{asset.assetId}}</td>
                    <td>{{asset.assetName}}</td>
                    <td>{{asset.description}}</td>
                    <td>{{asset.ipAddress}}</td>
                    <td>{{asset.macAddress}}</td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="5" style="text-align:center">No Data to Display</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </p-tabPanel>
        <p-tabPanel header="Asset Chart">
          <div class="canvas" id="canvas" style="margin-top: 20px;">
            <button pButton type="button" icon="pi pi-download" class="p-button-rounded p-button-text export-button" (click)="exportChart(assetLabelChart, 'C-PAT Asset Label Chart')"></button>
            <canvas #assetLabelsChart class="asset-label-chart"></canvas>
          </div>
        </p-tabPanel>
      </p-tabView>
      <div class="field">
        <p-dropdown id="assetid"
                    [options]="data"
                    optionLabel="assetName"
                    [(ngModel)]="asset.assetId"
                    placeholder="Select Asset to Modify..."
                    (onChange)="setAsset($event.value.assetId)"
                    appendTo="body"
                    styleClass="mt-2 w-full"
                    required>
        </p-dropdown>
      </div>
      <div class="field">
        <button pButton
                type="button"
                label="Add Asset"
                class="p-button-outlined p-button-info w-full"
                (click)="addAsset()">
        </button>
      </div>
    </p-card>
  </div>
</div>

<p-dialog header="Manage Assets" [(visible)]="assetDialogVisible" [modal]="true" [style]="{width: '50vw'}">
  <ng-template pTemplate="content">
    <cpat-asset [asset]="asset" [assets]="assets" [payload]="payload" (assetchange)="resetData(); closeAssetDialog();"></cpat-asset>
  </ng-template>
</p-dialog>
